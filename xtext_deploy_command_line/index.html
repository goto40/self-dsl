<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Deploy a command line version - self-dsl</title>
  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Deploy a command line version";
    var mkdocs_page_input_path = "xtext_deploy_command_line.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> self-dsl</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Welcome to self-dsl</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../motivation/">Motivation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../basics/">Basics of meta modeling for domain models</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Xtext</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../xtext_eclipse/">Eclipse</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_project_setup/">Xtext Project Setup</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_a_first_grammar/">A First Grammar</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_code_generation_xtend/">Code Generation (with Xtend)</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_model_validation/">Model Validation</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_xtend/">Xtend: Selected Aspects</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_scoping/">Scoping</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_modularization/">Modularization</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Deploy a command line version</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#xtext-deploy-a-command-line-version-of-the-code-generator">Xtext: deploy a command line version of the code generator</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#generate-a-command-line-version-of-the-code-generator">Generate a command line version of the code generator</a></li>
        
            <li><a class="toctree-l4" href="#optional-modify-mainjava">Optional: Modify Main.java</a></li>
        
            <li><a class="toctree-l4" href="#manually-create-a-runnable-jar-file-with-the-command-line-compiler">Manually create a runnable JAR file with the command line compiler</a></li>
        
            <li><a class="toctree-l4" href="#create-the-command-line-compiler-with-gradle">Create the command line compiler with gradle</a></li>
        
            <li><a class="toctree-l4" href="#create-the-command-line-compiler-with-maven">Create the command line compiler with maven</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_deploy_plugin/">Deploy an eclispe plugin</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_howtos/">Xtext HOWTOs</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">TextX</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../textx_intro/">TextX Intro</a>
                </li>
                <li class="">
                    
    <a class="" href="../textx_project_setup/">TextX Project Setup</a>
                </li>
                <li class="">
                    
    <a class="" href="../textx_by_examples/">TextX by Examples</a>
                </li>
                <li class="">
                    
    <a class="" href="../textx_modularization/">TextX Modularization</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../references/">References</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">self-dsl</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Xtext &raquo;</li>
        
      
    
    <li>Deploy a command line version</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="xtext-deploy-a-command-line-version-of-the-code-generator">Xtext: deploy a command line version of the code generator</h1>
<h2 id="generate-a-command-line-version-of-the-code-generator">Generate a command line version of the code generator</h2>
<p>Add the following entries to your mwe2 file (located side-by-side to your 
grammar; see e.g. <a href="../references/#bettini2016">(Bettini, 2016)</a>):</p>
<div class="codehilite"><pre><span></span>...
language = StandardLanguage {
    ...
    generator = {
        generateJavaMain = true
    }
    ...
}
...
</pre></div>


<p>When running the mwe2 script (compiling your grammar; 
see <a href="../xtext_project_setup/#xtext_compile_and_run">Compile and Run the Project</a>), a Main.java
file is created in the generator namespace side-by-side to your grammar.</p>
<h2 id="optional-modify-mainjava">Optional: Modify Main.java</h2>
<p>The Main-class expects a model file to be processed: parsed, validated and
generated code from the model.</p>
<ul>
<li>You can manually set the destination path (<strong>change "src-gen"</strong> to something 
    else).</li>
<li>There is no workspace for the model files; you must modify the Main.java 
    file in order to manually <strong>add other model files</strong> (e.g. from some sub folder or 
    specified via the command line). 
    E.g.:<div class="codehilite"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">runGenerator</span><span class="o">(</span><span class="n">String</span> <span class="n">main_model_filename</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">all_other_filenames</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Load the resource</span>
    <span class="n">ResourceSet</span> <span class="n">set</span> <span class="o">=</span> <span class="n">resourceSetProvider</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">Resource</span> <span class="n">resource</span> <span class="o">=</span> <span class="n">set</span><span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="n">URI</span><span class="o">.</span><span class="na">createFileURI</span><span class="o">(</span><span class="n">main_model_filename</span><span class="o">),</span> <span class="kc">true</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span> <span class="n">all_resources</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;();</span>
    <span class="n">all_resources</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">resource</span><span class="o">);</span>

    <span class="c1">// Load all other required resources</span>
    <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">m</span><span class="o">:</span><span class="n">all_other_filenames</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">m</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">main_model_filename</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">Resource</span> <span class="n">other</span> <span class="o">=</span> <span class="n">set</span><span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="n">URI</span><span class="o">.</span><span class="na">createFileURI</span><span class="o">(</span><span class="n">m</span><span class="o">),</span> <span class="kc">true</span><span class="o">);</span>
            <span class="n">all_resources</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">other</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// Validate all resources</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Resource</span> <span class="n">r</span><span class="o">:</span> <span class="n">all_resources</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Issue</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">CheckMode</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">CancelIndicator</span><span class="o">.</span><span class="na">NullImpl</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">list</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Issue</span> <span class="n">issue</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">issue</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// Configure and start the generator</span>
    <span class="n">fileAccess</span><span class="o">.</span><span class="na">setOutputPath</span><span class="o">(</span><span class="s">&quot;src-gen/&quot;</span><span class="o">);</span>
    <span class="n">GeneratorContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GeneratorContext</span><span class="o">();</span>
    <span class="n">context</span><span class="o">.</span><span class="na">setCancelIndicator</span><span class="o">(</span><span class="n">CancelIndicator</span><span class="o">.</span><span class="na">NullImpl</span><span class="o">);</span>
    <span class="n">generator</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="n">resource</span><span class="o">,</span> <span class="n">fileAccess</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Code generation finished.&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


</li>
</ul>
<h2 id="manually-create-a-runnable-jar-file-with-the-command-line-compiler">Manually create a runnable JAR file with the command line compiler</h2>
<p>In eclipse you can "<strong>Export</strong>" your generator as "<strong>Runnable JAR</strong>":</p>
<ul>
<li>Create a Run Configuration by right-clicking on your Main.java and select 
    "Run as" / "Java Application".</li>
<li>Then right-click on the project containing the Main.java file and select 
    "Export", "Runnable JAR file".</li>
<li>Select "Main" in the "Launch configuration".</li>
<li>Select "Package required libraries into generated JAR file".</li>
<li>Specify your destination JAR file name and click "Finish".</li>
</ul>
<h2 id="create-the-command-line-compiler-with-gradle">Create the command line compiler with gradle</h2>
<p>See <a href="https://gitlab.com/Tim-S/xtext-dsl-headless-example">https://gitlab.com/Tim-S/xtext-dsl-headless-example</a>
for a very nice and compact description: you will learn how to
deploy a command line version of the "Hello World" grammar
using a few lines of code.</p>
<h2 id="create-the-command-line-compiler-with-maven">Create the command line compiler with maven</h2>
<p><strong>(work in progress)</strong></p>
<ul>
<li>Close eclipse </li>
<li>Clone <a href="https://github.com/basilfx/xtext-standalone-maven-build">https://github.com/basilfx/xtext-standalone-maven-build</a>
   into some temporary directory (there is a good description there what to do)</li>
<li>Copy the ...standalone-folder into your ...parent folder (side-by-side 
    to your other projects)</li>
<li>Rename the folder to match your project name (e.g. 
    "org.xtext.example.mydsl.standalone" to 
    "org.example.domainmodel.standalone")</li>
<li>Rename (find/replace) the project name (replace "org.xtext.example.mydsl"
    with "org.example.domainmodel") in all files in the copied folder.</li>
<li>Add the new folder/module to the modules list in your master pom.xml file
    (section "modules").</li>
<li>try "mvn package" in your master directory and check if the target in
    the new standalone module is created. The generated JAR file can then be 
    tested as follows (assuming some model files are available):<div class="codehilite"><pre><span></span>java -jar org.example.domainmodel.standalone/target/org.example.domainmodel.standalone-1.0.0-SNAPSHOT.jar *.dmodel
</pre></div>


</li>
</ul>
<p>Note: 
 * no need to add (import) the standalone project into the eclipse 
    workspace.
 * You can use the standalone code generator as "compiler" in a Makefile
    (like gcc). It will perform a model syntax check, a model validation and a 
    code generation.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../xtext_deploy_plugin/" class="btn btn-neutral float-right" title="Deploy an eclispe plugin">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../xtext_modularization/" class="btn btn-neutral" title="Modularization"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../xtext_modularization/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../xtext_deploy_plugin/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
